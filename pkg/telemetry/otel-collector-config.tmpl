receivers:
{{- if eq .OS "windows"}}
  windowseventlog/application:
    channel: application
  windowseventlog/security:
    channel: security

  # Tail your service log files
  filelog/services:
    include:
      - 'C:\warpbuilds\runner.github.stdout.log'
      - 'C:\warpbuilds\runner.github.stderr.log'
      - 'C:\warpbuilds\warpbuild-agentd.stdout.log'
      - 'C:\warpbuilds\warpbuild-agentd.stderr.log'
      - 'C:\warpbuilds\warpbuild-telemetryd.stdout.log'
      - 'C:\warpbuilds\warpbuild-telemetryd.stderr.log'
    start_at: end
    max_log_size: 200KiB
    include_file_name: true
    include_file_path: true
    poll_interval: 20s
{{- else}}
  filelog:
    include: ['{{.SyslogFilePath}}']
    start_at: 'end'
    max_log_size: 200KiB
    include_file_name: false
    include_file_path: false
    poll_interval: 20s
{{- end}}

  hostmetrics:
    collection_interval: 20s
    scrapers:
      memory:
      filesystem:
        metrics:
          system.filesystem.inodes.usage:
            enabled: false
      load:
        metrics:
          system.cpu.load_average.1m:
            enabled: true
          system.cpu.load_average.5m:
            enabled: false

processors:
  batch:
    timeout: {{.PushFrequency}}
    send_batch_size: 1000

exporters:
  file:
    path: '{{.ExportFilePath}}'
    format: json
    append: false
    rotation:
      max_megabytes: 1
      max_backups: 1

service:
  pipelines:
    logs:
      receivers: [{{- if eq .OS "windows"}}windowseventlog/application, windowseventlog/security, filelog/services{{- else}}filelog{{- end}}]
      processors: [batch]
      exporters: [file]
    metrics:
      receivers: [hostmetrics]
      processors: [batch]
      exporters: [file]
  telemetry:
    metrics:
      level: none
    logs:
      level: DEBUG